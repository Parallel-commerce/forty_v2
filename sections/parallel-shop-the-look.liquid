{% schema %}
{
  "name": "Shop The Look",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Shop The Look"
    },
    {
      "type": "select",
      "id": "heading_alignment",
      "label": "Heading alignment",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "center"
    },
    {
      "type": "image_picker",
      "id": "look_image",
      "label": "Look Image"
    }
  ],
  "blocks": [
    {
      "type": "product_dot",
      "name": "Product Dot",
      "limit": 4,
      "settings": [
        {
          "type": "product",
          "id": "product",
          "label": "Product"
        },
        {
          "type": "range",
          "id": "position_x",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "%",
          "label": "Horizontal Position",
          "default": 50
        },
        {
          "type": "range",
          "id": "position_y",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "%",
          "label": "Vertical Position",
          "default": 50
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Shop The Look",
      "category": "Image",
      "blocks": [
        {
          "type": "product_dot"
        },
        {
          "type": "product_dot"
        },
        {
          "type": "product_dot"
        }
      ]
    }
  ]
}
{% endschema %}

<div class="shop-the-look">
  <div class="page-width">
    {% if section.settings.heading != blank %}
      <h2 class="shop-the-look__heading text-{{ section.settings.heading_alignment }}">{{ section.settings.heading }}</h2>
    {% endif %}
    
    <div class="shop-the-look__grid">
      <div class="shop-the-look__column shop-the-look__column--image">
        <div class="shop-the-look__image-wrapper">
          {% if section.settings.look_image != blank %}
            {{ section.settings.look_image | image_url: width: 1000 | image_tag:
              loading: 'lazy',
              class: 'shop-the-look__image',
              alt: section.settings.look_image.alt | escape
            }}
          {% else %}
            {{ 'image' | placeholder_svg_tag: 'placeholder-svg' }}
          {% endif %}
          
          {% for block in section.blocks %}
            {% if block.type == 'product_dot' and block.settings.product != blank %}
              <button 
                class="shop-the-look__dot"
                style="left: {{ block.settings.position_x }}%; top: {{ block.settings.position_y }}%;"
                data-product-id="{{ block.settings.product.id }}"
                aria-label="{{ block.settings.product.title }}"
              >
                <span class="shop-the-look__dot-inner"></span>
              </button>
            {% endif %}
          {% endfor %}
        </div>
      </div>
      <div class="shop-the-look__column shop-the-look__column--content">
        <div class="shop-the-look__products">
          {% for block in section.blocks %}
            {% if block.type == 'product_dot' and block.settings.product != blank %}
              <div class="shop-the-look__product" data-product-id="{{ block.settings.product.id }}">
                <a href="{{ block.settings.product.url }}" class="shop-the-look__product-link">
                  <div class="shop-the-look__product-image-wrapper">
                    {% if block.settings.product.featured_image != blank %}
                      {{ block.settings.product.featured_image | image_url: width: 300 | image_tag:
                        loading: 'lazy',
                        class: 'shop-the-look__product-image',
                        alt: block.settings.product.featured_image.alt | escape
                      }}
                    {% else %}
                      {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
                    {% endif %}
                  </div>
                  <div class="shop-the-look__product-info">
                    <h3 class="shop-the-look__product-title">{{ block.settings.product.title }}</h3>
                    <p class="shop-the-look__product-price">
                      {{ block.settings.product.price | money }}
                    </p>
                  </div>
                </a>
              </div>
            {% endif %}
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .shop-the-look {
    padding: 40px 0;
  }

  .shop-the-look__heading {
    margin-bottom: 30px;
    font-size: 28px;
  }

  .text-left {
    text-align: left;
  }

  .text-center {
    text-align: center;
  }

  .text-right {
    text-align: right;
  }

  .shop-the-look__grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
    align-items: start;
  }

  .shop-the-look__column {
    width: 100%;
  }

  .shop-the-look__image-wrapper {
    position: relative;
    width: 100%;
  }

  .shop-the-look__image {
    width: 100%;
    height: auto;
    display: block;
  }

  .shop-the-look__dot {
    position: absolute;
    transform: translate(-50%, -50%);
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.8);
    border: 2px solid #000;
    cursor: pointer;
    padding: 0;
    transition: transform 0.2s ease;
    z-index: 2;
  }

  .shop-the-look__dot:hover {
    transform: translate(-50%, -50%) scale(1.1);
  }

  .shop-the-look__dot-inner {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: #000;
  }

  .shop-the-look__dot.active {
    background: #000;
  }

  .shop-the-look__dot.active .shop-the-look__dot-inner {
    background: #fff;
  }

  .shop-the-look__dot.pulse {
    animation: dotPulse 1s infinite;
  }

  @keyframes dotPulse {
    0% {
      box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.7);
    }
    70% {
      box-shadow: 0 0 0 15px rgba(255, 255, 255, 0);
    }
    100% {
      box-shadow: 0 0 0 0 rgba(255, 255, 255, 0);
    }
  }

  .shop-the-look__products {
    display: flex;
    flex-direction: column;
    gap: 12px;
    height: 100%;
  }

  .shop-the-look__product {
    width: 100%;
    transition: all 0.3s ease;
  }

  .shop-the-look__product.active {
    transform: translateX(10px);
    background: rgba(0, 0, 0, 0.02);
    border-radius: 4px;
  }

  .shop-the-look__product-link {
    text-decoration: none;
    color: inherit;
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 8px;
  }

  .shop-the-look__product-image-wrapper {
    flex: 0 0 80px;
    position: relative;
    padding-bottom: 80px;
  }

  .shop-the-look__product-image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .shop-the-look__product-info {
    flex: 1;
  }

  .shop-the-look__product-title {
    font-size: 14px;
    margin: 0 0 4px;
    line-height: 1.2;
  }

  .shop-the-look__product-price {
    font-size: 13px;
    margin: 0;
  }

  @media screen and (max-width: 749px) {
    .shop-the-look__grid {
      grid-template-columns: 1fr;
    }

    .shop-the-look__products {
      gap: 15px;
    }

    .shop-the-look__product-image-wrapper {
      flex: 0 0 60px;
      padding-bottom: 60px;
    }
  }
</style>

<script>
  class ShopTheLook {
    constructor() {
      this.dots = document.querySelectorAll('.shop-the-look__dot');
      this.products = document.querySelectorAll('.shop-the-look__product');
      this.init();
    }

    init() {
      this.dots.forEach(dot => {
        dot.addEventListener('click', () => this.handleDotClick(dot));
        dot.addEventListener('mouseenter', () => this.handleDotHover(dot));
        dot.addEventListener('mouseleave', () => this.handleDotLeave(dot));
      });

      this.products.forEach(product => {
        product.addEventListener('mouseenter', () => this.handleProductHover(product));
        product.addEventListener('mouseleave', () => this.handleProductLeave(product));
      });
    }

    handleDotClick(dot) {
      const productId = dot.dataset.productId;
      this.highlightProduct(productId);
      this.highlightDot(dot);
    }

    handleDotHover(dot) {
      const productId = dot.dataset.productId;
      this.highlightProduct(productId);
    }

    handleDotLeave(dot) {
      if (!dot.classList.contains('active')) {
        const productId = dot.dataset.productId;
        this.unhighlightProduct(productId);
      }
    }

    handleProductHover(product) {
      const productId = product.dataset.productId;
      const dot = this.getDotByProductId(productId);
      if (dot) {
        this.dots.forEach(d => d.classList.remove('pulse'));
        dot.classList.add('pulse');
        this.highlightProduct(productId);
      }
    }

    handleProductLeave(product) {
      const productId = product.dataset.productId;
      const dot = this.getDotByProductId(productId);
      if (dot) {
        dot.classList.remove('pulse');
        this.unhighlightProduct(productId);
      }
    }

    getDotByProductId(productId) {
      return document.querySelector(`.shop-the-look__dot[data-product-id="${productId}"]`);
    }

    highlightProduct(productId) {
      this.products.forEach(product => {
        if (product.dataset.productId === productId) {
          product.classList.add('active');
        } else {
          product.classList.remove('active');
        }
      });
    }

    unhighlightProduct(productId) {
      const product = document.querySelector(`.shop-the-look__product[data-product-id="${productId}"]`);
      if (product) {
        product.classList.remove('active');
      }
    }

    highlightDot(dot) {
      this.dots.forEach(d => {
        d.classList.remove('active');
        d.classList.remove('pulse');
      });
      dot.classList.add('active');
    }
  }

  // Initialize when DOM is loaded
  document.addEventListener('DOMContentLoaded', () => {
    new ShopTheLook();
  });
</script>
